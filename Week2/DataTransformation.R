## ---- warning=FALSE,message=FALSE,error=FALSE, results='hide'----------------------------------------------------------
#install.packages("nycflights13")
library(nycflights13)
library(tidyverse)


## ----------------------------------------------------------------------------------------------------------------------
flights


## ----------------------------------------------------------------------------------------------------------------------
summary(flights)


## ----------------------------------------------------------------------------------------------------------------------
filter(flights, month == 5, day == 1)


## ----------------------------------------------------------------------------------------------------------------------
(june25 <- filter(flights, month == 6, day == 25))


## ----------------------------------------------------------------------------------------------------------------------
filter(flights, month == 6 | month == 12)


## ----------------------------------------------------------------------------------------------------------------------
nov_dec <- filter(flights, month %in% c(11, 12))
nov_dec


## ----------------------------------------------------------------------------------------------------------------------
filter(flights, !(arr_delay > 120 | dep_delay > 120))


## ----------------------------------------------------------------------------------------------------------------------
x <- NA
is.na(x)


## ----------------------------------------------------------------------------------------------------------------------
df <- tibble(x = c(1, NA, 3))

filter(df, is.na(x) | x > 1)


## ----------------------------------------------------------------------------------------------------------------------
arrange(flights, year, month, day)


## ----------------------------------------------------------------------------------------------------------------------
arrange(flights, desc(dep_delay))


## ----------------------------------------------------------------------------------------------------------------------
select(flights, year, month, day)


## ----------------------------------------------------------------------------------------------------------------------
#select all columns between year and day.
select(flights, year:day)


## ----------------------------------------------------------------------------------------------------------------------
#select all columns except those from year to day
select(flights, -(year:day))


## ----------------------------------------------------------------------------------------------------------------------
#everything() moves some variables to the start of the data frame
select(flights, time_hour, air_time, day, everything())


## ----------------------------------------------------------------------------------------------------------------------
flights_sml <- select(flights, 
  year:day, 
  ends_with("delay"), 
  distance, 
  air_time
)

mutate(flights_sml,
  gain = dep_delay - arr_delay,
  speed = distance / air_time * 60
)


## ----------------------------------------------------------------------------------------------------------------------
transmute(flights,
  gain = dep_delay - arr_delay,
  hours = air_time / 60,
  gain_per_hour = gain / hours
)


## ----------------------------------------------------------------------------------------------------------------------
transmute(flights,
  dep_time,
  hour = dep_time %/% 100,
  minute = dep_time %% 100
)


## ----------------------------------------------------------------------------------------------------------------------
(x <- 1:10)
lag(x)
lead(x)


## ----------------------------------------------------------------------------------------------------------------------
cumsum(x)
#cumulative means
cummean(x)


## ----------------------------------------------------------------------------------------------------------------------
summarise(flights, delay = mean(dep_delay, na.rm = TRUE))


## ---- warning=FALSE, error=FALSE, message=FALSE------------------------------------------------------------------------
by_day <- group_by(flights, year, month, day)
summarise(by_day, delay = mean(dep_delay, na.rm = TRUE))


## ---- message=FALSE----------------------------------------------------------------------------------------------------
flights %>% 
  group_by(year, month, day) %>% 
  summarise(mean = mean(dep_delay, na.rm = TRUE))

